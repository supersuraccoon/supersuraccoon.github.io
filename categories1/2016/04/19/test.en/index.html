<!DOCTYPE html>
<html>

    <head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>test33</title>
<meta name="description" content="SuperSuRaccoon's Blog">

<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="stylesheet" type="text/css" media="all" href="/css/bootstrap.min.css" />
<link rel="stylesheet" type="text/css" media="all" href="/css/font-awesome.min.css" />
<link rel="stylesheet" type="text/css" media="all" href="/css/style.css" />
<link rel="stylesheet" type="text/css" media="all" href="/css/jquery.mmenu.all.css" />
<link rel="stylesheet" href="/css/highlightjs.piperita.css">
<link rel="stylesheet" type="text/css" media="all" href="/css/animate.css" />

<!-- Favicons generated at http://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="57x57" href="/favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/favicons/apple-touch-icon-76x76.png">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/favicons/manifest.json">
<link rel="shortcut icon" href="/favicons/favicon.ico">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


<!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-56ebab41c4c7354d"></script>

</head>


    <body>

    <nav id="my-menu" style="visibility:hidden;">
  <div>
    <ul class="pages">
      
        <li><a href="/"><i class="fa fa-home"></i> Home</a></li>
        <li><a href="/posts"><i class="fa fa-archive"></i> All Posts</a></li>
        <li><a href="/categories"><i class="fa fa-list"></i> Categories</a></li>
        <li><a href="/tags"><i class="fa fa-tags"></i> Tags</a></li>
        <li><a href="/search"><i class="fa fa-search"></i> Search</a></li>

        <br>
        <hr width="70%" style="border: 0; border-bottom: 2px dotted #ccc; background: #000000;">
        <li><a href="/"><i class="fa fa-check-square-o"></i>English</a></li>
        <li><a href="/cn"><i class="fa fa-square-o"></i>Chinese</a></li>
        <li><a href="/jp"><i class="fa fa-square-o"></i>Japanese</a></li>
      

      

      

    </ul>
    <hr width="80%">
    <p class="links">
  
  	<a href="http://www.twitter.com/supersuraccoon" target="_new">
  	<i class="fa fa-twitter"></i></a>
  

  
  	<a href="https://www.facebook.com/supersuraccoon" target="_new">
  	<i class="fa fa-facebook-square"></i></a>
  

  
  	<a href="http://weibo.com/supersuraccoon" target="_new">
  	<i class="fa fa-weibo"></i></a>
  
  
  
  	<a href="https://github.com/supersuraccoon" target="_new">
  	<i class="fa fa-github-alt"></i></a>
  

  <a href="http://www.supersuraccoon-cocos2d.com" target="_new">
  <i class="fa fa-wordpress"></i></a>
</p>

  </div>
</nav>
<div class="menu-button" href="#menu"><i class="fa fa-bars"></i></div>

    <div class="page-content">
      <div class="wrap">
      

<div class="container-fluid single">
  <div class="row">

    <div itemscope itemtype="http://schema.org/Article" class="col-md-12 article">
      
      <div class="thumb">
        <i class="fa fa-heart fa-4x"></i>
      </div>
      

      <h1 class="header" itemprop="name">test33</h1>

      <div class="author">
        
        <small><i>
          
          by
          <span itemprop="author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person">
              <span itemprop="name">SuperSuRaccoon</span>
            </span>
          </span>
          
          on <span itemprop="datePublished">2016-04-19</span>
           under categories1
        </i></small>
        

        

        
      </div>

<!--       <div class="read-time">
        <small>
          23 minute read
        </small>
      </div> -->

      <div class="content-panel content">
        <span itemprop="articleBody"><h2 id="develop-enviroment-setup">Develop Enviroment Setup</h2>

<p><a href="https://github.com/google/protobuf/releases/tag/v3.0.0-beta-2">Protocol Buffers v3.0.0-beta-2</a></p>

<p>Released on Dec 31, 2015</p>

<div class="highlighter-rouge"><pre class="highlight"><code>libprotobuf.a, building <span class="k">for </span>OSX, but linking <span class="k">in </span>object file built <span class="k">for </span>iOS, <span class="k">for </span>architecture x86_64
</code></pre>
</div>

<p><a href="https://github.com/google/protobuf/releases/tag/v2.5.0">Protocol Buffers v2.5.0</a></p>

<p>Released on Feb 28, 2013</p>

<p><br /></p>

<h3 id="complie-libprotobufa">Complie <code class="highlighter-rouge">libprotobuf.a</code></h3>

<p><a href="https://github.com/sinofool/build-protobuf-ios">build-protobuf-ios</a></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">roor$ </span><span class="nb">cd</span> /usr/local/lib
<span class="gp">roor$ </span>ls -al
libprotobuf.a

<span class="gp">root$ </span>protoc --version
libprotoc 2.5.0
</code></pre>
</div>

<h4 id="armarchitecture">ARM architecture</h4>

<ul>
  <li>
    <p>x86_64</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>Mac OS X
</code></pre>
    </div>
  </li>
  <li>
    <p>i386
iPhone Simulator</p>
  </li>
  <li>
    <p>armv6</p>

    <p>iPhone</p>

    <p>iPhone2</p>

    <p>iPhone3G</p>

    <p>iPod Touch</p>
  </li>
  <li>
    <p>armv7</p>

    <p>iPhone3GS</p>

    <p>iPhone4</p>

    <p>iPhone4S</p>

    <p>iPad</p>

    <p>iPad2</p>

    <p>iPad3</p>

    <p>iPad mini</p>

    <p>iPod Touch 3G</p>

    <p>iPod Touch4</p>
  </li>
  <li>
    <p>armv7s</p>

    <p>iPhone5</p>

    <p>iPhone5C</p>

    <p>iPad4</p>
  </li>
  <li>
    <p>arm64</p>

    <p>iPhone5S</p>

    <p>iPhone6</p>

    <p>iPhone6 Plus</p>

    <p>iPhone6S</p>

    <p>iPad Air</p>

    <p>iPad mini2</p>
  </li>
</ul>

<p><code class="highlighter-rouge">lipo thin</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code>lipo xxx.a -thin <span class="o">[</span>armv7|armv7s|arm64|i386|x86_64] -output xxx_thin.a
</code></pre>
</div>

<p><br /></p>

<h3 id="xcode-setup">Xcode Setup</h3>

<h4 id="add-source">Add Source</h4>

<ul>
  <li>
    <p>Add folder <code class="highlighter-rouge">protobuf-2.5.0/src/google</code> to <code class="highlighter-rouge">Xcode</code></p>

    <pre><code class="language-C++">  - Classes
    - protobuf
        - google
            - srouce code
        - lib
            - libprotobuf.a
</code></pre>
  </li>
  <li>
    <p>Remove files</p>

    <ul>
      <li>All <code class="highlighter-rouge">.proto</code></li>
      <li>All <code class="highlighter-rouge">.cc</code></li>
    </ul>
  </li>
  <li>
    <p>Remove folder</p>

    <ul>
      <li><code class="highlighter-rouge">testing</code></li>
      <li><code class="highlighter-rouge">testdata</code></li>
    </ul>
  </li>
  <li>
    <p>Modify file <code class="highlighter-rouge">stubs/platform_macros.h</code></p>

    <pre><code class="language-C++">// ...
#elif defined(__ppc__)
#define GOOGLE_PROTOBUF_ARCH_PPC 1
#define GOOGLE_PROTOBUF_ARCH_32_BIT 1
// add start
#elif defined(__aarch64__)
#define GOOGLE_PROTOBUF_ARCH_ARM 1
#define GOOGLE_PROTOBUF_ARCH_64_BIT 1
// add end
// ...
</code></pre>
  </li>
</ul>

<p><br /></p>

<h4 id="add-libprotobufa">Add <code class="highlighter-rouge">libprotobuf.a</code></h4>

<p>Add the <code class="highlighter-rouge">libprotobuf.a</code> to <code class="highlighter-rouge">Build Parses ==&gt; Link Binary With Libraries</code></p>

<p><br /></p>

<h4 id="modify-search-path">Modify Search Path</h4>

<ul>
  <li>
    <p><code class="highlighter-rouge">Build Settings == &gt; Search Paths ==&gt; User Header Search Paths</code></p>

    <div class="highlighter-rouge"><pre class="highlight"><code>    eg : `$(SRCROOT)/../Classes/protobuf`
</code></pre>
    </div>
  </li>
  <li>
    <p><code class="highlighter-rouge">Build Settings == &gt; Search Paths ==&gt; Library Search Paths</code></p>

    <p>eg : <code class="highlighter-rouge">$(SRCROOT)/../Classes/protobuf/lib</code></p>
  </li>
</ul>

<p><br /></p>

<h2 id="message-proto">Message Proto</h2>

<h3 id="define-protos">Define Protos</h3>

<p><code class="highlighter-rouge">GameInfo.proto</code></p>

<pre><code class="language-C++">package game.info;

option java_package = "com.game.info";
option java_outer_classname = "GameInfoProtos";

import "GameEnum.proto";

// role info
message RoleInfo {
    required string name                    = 1;
    required enumeration.RoleType type      = 2;    
}

// item info
message ItemInfo {
    required string name                    = 1;
    optional int32 price                    = 2;
}

// game info
message GameInfo {
    repeated RoleInfo roleInfo              = 1;
    repeated ItemInfo itemInfo              = 2;
}
</code></pre>

<p><code class="highlighter-rouge">GameEnum.proto</code></p>

<pre><code class="language-C++">package game.enumeration;

option java_package = "com.game.enumeration";
option java_outer_classname = "GameEnumProtos";

// enumeration type
enum RoleType {
    FIGHTER     = 1;
    BOWMAN      = 2;
    MAGICIAN    = 3;
}
</code></pre>

<p><br /></p>

<h3 id="compiler-proto">Compiler <code class="highlighter-rouge">.proto</code></h3>

<div class="highlighter-rouge"><pre class="highlight"><code>protoc 
    --proto_path<span class="o">=</span>IMPORT_PATH 
    --cpp_out<span class="o">=</span>DST_DIR 
    --java_out<span class="o">=</span>DST_DIR 
    --python_out<span class="o">=</span>DST_DIR 
    path/to/file.proto
</code></pre>
</div>

<p>and will generate :</p>

<ul>
  <li><code class="highlighter-rouge">c++</code>
    <ul>
      <li><code class="highlighter-rouge">GameEnum.pb.h</code></li>
      <li><code class="highlighter-rouge">GameEnum.pb.cc</code></li>
      <li><code class="highlighter-rouge">GameInfo.pb.h</code></li>
      <li><code class="highlighter-rouge">GameInfo.pb.cc</code></li>
    </ul>
  </li>
  <li>java</li>
  <li>game
    <ul>
      <li>enumeration
        <ul>
          <li><code class="highlighter-rouge">GameEnumProtos.java</code></li>
        </ul>
      </li>
      <li>info
        <ul>
          <li><code class="highlighter-rouge">GameInfoProtos.java</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">python</code>
    <ul>
      <li><code class="highlighter-rouge">GameEnum_pb2.py</code></li>
      <li><code class="highlighter-rouge">GameInfo_pb2.py</code></li>
    </ul>
  </li>
  <li>
    <p><code class="highlighter-rouge">javascript</code></p>

    <div class="highlighter-rouge"><pre class="highlight"><code>Only `.proto` needed.
</code></pre>
    </div>
  </li>
</ul>

<p><br /></p>

<h2 id="serialize--parse--c">Serialize &amp;&amp; Parse / <code class="highlighter-rouge">C++</code></h2>

<h4 id="folder-structure"><code class="highlighter-rouge">Folder structure</code></h4>

<pre><code class="language-C++">- CPP
    // proto generated files
    - GameEnum.pb.h
    - GameEnum.pb.cc
    - GameInfo.pb.h
    - GameInfo.pb.cc
    // .proto
    - proto
        - GameInfo.proto
        - GameEnum.proto
    // protobuf source code
    - google
        - protobuf
            - // ...
    // main test file
    - CPP_TEST.cpp
</code></pre>

<p><br /></p>

<h4 id="create-instance"><code class="highlighter-rouge">Create Instance</code></h4>

<pre><code class="language-C++">// Create a GameInfo object first
game::info::GameInfo gameInfo;

// add RoleInfo object to repeated field
game::info::RoleInfo *pRoleInfo1 = gameInfo.add_roleinfo();
pRoleInfo1-&gt;set_name("name1");
pRoleInfo1-&gt;set_type(game::enumeration::FIGHTER);

// add another RoleInfo object to repeated field
game::info::RoleInfo *pRoleInfo2 = gameInfo.add_roleinfo();
pRoleInfo2-&gt;set_name("name2");
pRoleInfo2-&gt;set_type(game::enumeration::BOWMAN);

// add ItemInfo object to repeated field
game::info::ItemInfo *pItemInfo1 = gameInfo.add_iteminfo();
pItemInfo1-&gt;set_name("item1");
pItemInfo1-&gt;set_price(100);

// add another ItemInfo object to repeated field
game::info::ItemInfo *pItemInfo2 = gameInfo.add_iteminfo();
pItemInfo2-&gt;set_name("item2");
pItemInfo2-&gt;set_price(200);
</code></pre>

<p><br /></p>

<h4 id="serialize-to-string"><code class="highlighter-rouge">Serialize to String</code></h4>

<pre><code class="language-C++">std::string gameInfoString;
gameInfo.SerializeToString(&amp;gameInfoString);
</code></pre>

<p><br /></p>

<h4 id="serialize-to-file"><code class="highlighter-rouge">Serialize to File</code></h4>

<pre><code class="language-C++">ofstream outputFile("GameInfo.bin", std::ostream::binary);
gameInfo.SerializeToOstream(&amp;outputFile);
</code></pre>

<p><br /></p>

<h4 id="parse-from-string"><code class="highlighter-rouge">Parse from String</code></h4>

<pre><code class="language-C++">game::info::GameInfo gameInfo;
gameInfo.ParseFromString(gameInfoString);
</code></pre>

<p><br /></p>

<h4 id="parse-from-file"><code class="highlighter-rouge">Parse from File</code></h4>

<pre><code class="language-C++">game::info::GameInfo gameInfo;
ifstream is("GameInfo.bin", std::ifstream::binary);
gameInfo.ParseFromIstream(&amp;is);
is.close();
</code></pre>

<p><br /></p>

<h4 id="dump-gameinfo-instance"><code class="highlighter-rouge">Dump GameInfo Instance</code></h4>

<pre><code class="language-C++">// RoleInfo Array
for (int i = 0; i &lt; gameInfo.roleinfo_size(); i++) {
    // role info
    game::info::RoleInfo roleInfo = gameInfo.roleinfo(i);
    printf("roleInfo: \n%s\n", roleInfo.Utf8DebugString().c_str());
}

// ItemInfo Array
for (int i = 0; i &lt; gameInfo.iteminfo_size(); i++) {
    // role info
    game::info::ItemInfo itemInfo = gameInfo.iteminfo(i);
    printf("itemInfo: \n%s\n", itemInfo.Utf8DebugString().c_str());
}
</code></pre>

<p><br /></p>

<h4 id="relection-dump-message"><code class="highlighter-rouge">Relection Dump Message</code></h4>

<pre><code class="language-C++">void dumpMessageReflection(const Message* pMessageInfo)
{
    // Descriptor
    const Descriptor* pDescriptor = pMessageInfo-&gt;GetDescriptor();
    // Reflection
    const Reflection* pReflection = pMessageInfo-&gt;GetReflection();
    // Fields
    for (int i = 0; i &lt; pDescriptor-&gt;field_count(); i ++) {
        const FieldDescriptor* pMessageField = pDescriptor-&gt;field(i);
        int fieldSize = pMessageField-&gt;is_repeated() ? 
            pReflection-&gt;FieldSize(*pMessageInfo, pMessageField) : 0;
        // Field
        switch(pMessageField-&gt;type()) {
            case FieldDescriptor::TYPE_INT64 :
            case FieldDescriptor::TYPE_UINT64 :
            case FieldDescriptor::TYPE_FIXED64 :
            case FieldDescriptor::TYPE_FIXED32 :
            case FieldDescriptor::TYPE_BOOL :
            case FieldDescriptor::TYPE_GROUP :
            case FieldDescriptor::TYPE_BYTES :
            case FieldDescriptor::TYPE_UINT32 :
            case FieldDescriptor::TYPE_SFIXED32 :
            case FieldDescriptor::TYPE_SFIXED64 :
            case FieldDescriptor::TYPE_SINT32 :
            case FieldDescriptor::TYPE_SINT64 :
                printf("FieldDescriptor type not handled !");
                break;
            case FieldDescriptor::TYPE_INT32 :
                if (fieldSize == 0) {
                    printf("Value: %d\n\n", 
                        pReflection-&gt;GetInt32(*pMessageInfo, pMessageField)
                    );
                }
                else {
                    for (int j = 0; j &lt; fieldSize; j ++) {
                        printf("Value: %d\n\n", 
                            pReflection-&gt;GetRepeatedInt32(
                                *pMessageInfo, pMessageField, j
                            )
                        );
                    }
                }
                break;
            case FieldDescriptor::TYPE_FLOAT :
                if (fieldSize == 0) {
                    printf("Value: %f\n\n", 
                        pReflection-&gt;GetFloat(*pMessageInfo, pMessageField)
                    );
                }
                else {
                    for (int j = 0; j &lt; fieldSize; j ++) {
                        printf("Value: %f\n\n", 
                            pReflection-&gt;GetRepeatedFloat(
                                *pMessageInfo, pMessageField, j
                            )
                        );
                    }
                }
                break;
            case FieldDescriptor::TYPE_DOUBLE :
                if (fieldSize == 0) {
                    printf("Value: %lf\n\n", 
                        pReflection-&gt;GetDouble(*pMessageInfo, pMessageField)
                    );
                }
                else {
                    for (int j = 0; j &lt; fieldSize; j ++) {
                        printf("Value: %lf\n\n", 
                            pReflection-&gt;GetRepeatedDouble(
                                *pMessageInfo, pMessageField, j
                            )
                        );
                    }
                }
                break;
            case FieldDescriptor::TYPE_STRING :
                if (fieldSize == 0) {
                    printf("Value: %s\n\n", 
                        pReflection-&gt;GetString(
                            *pMessageInfo, pMessageField
                        ).c_str()
                    );
                }
                else {
                    for (int j = 0; j &lt; fieldSize; j ++) {
                        printf("Value: %s\n\n", 
                            pReflection-&gt;GetRepeatedString(
                                *pMessageInfo, pMessageField, j
                            ).c_str()
                        );
                    }
                }
                break;
            case FieldDescriptor::TYPE_ENUM :
                if (fieldSize == 0) {
                    printf("Value: %d\n\n", 
                        pReflection-&gt;GetEnum(
                            *pMessageInfo, pMessageField
                        )-&gt;number()
                    );
                }
                else {
                    for (int j = 0; j &lt; fieldSize; j ++) {
                        printf("Value: %d\n\n", 
                            pReflection-&gt;GetRepeatedEnum(
                                *pMessageInfo, pMessageField, j
                            )-&gt;number()
                        );
                    }
                }
                break;
            case FieldDescriptor::TYPE_MESSAGE :
                // recurse
                if (fieldSize == 0) {
                    dumpMessageReflection(
                        &amp;pReflection-&gt;GetMessage(*pMessageInfo, pMessageField)
                    );
                }
                else {
                    for (int j = 0; j &lt; fieldSize; j ++) {
                        dumpMessageReflection(
                            &amp;pReflection-&gt;GetRepeatedMessage(
                                *pMessageInfo, pMessageField, j
                            )
                        );
                    }
                }
                break;
            default:
                break;
        }
    }
}
</code></pre>

<p><br /></p>

<h4 id="relection-generate-message"><code class="highlighter-rouge">Relection Generate Message</code></h4>

<pre><code class="language-C++">compiler::DiskSourceTree sourceTree;
sourceTree.MapPath("", "./proto");
compiler::Importer importer(&amp;sourceTree, NULL);
importer.Import("GameEnum.proto");
importer.Import("GameInfo.proto");

DynamicMessageFactory factory;
const Descriptor* pDescriptorDynamic = NULL;
const Reflection* pReflectionDynamic = NULL;
const FieldDescriptor* pFieldDynamic = NULL;
const EnumDescriptor* pEnumDescriptorDynamic = NULL;
Message* pGameInfoDynamic = NULL;
Message* pRoleInfoDynamic = NULL;
Message* pItemInfoDynamic = NULL;

// create a instance of GameInfo
pDescriptorDynamic = importer.pool()-&gt;FindMessageTypeByName("game.info.GameInfo");
pGameInfoDynamic = factory.GetPrototype(pDescriptorDynamic)-&gt;New();
pReflectionDynamic = pGameInfoDynamic-&gt;GetReflection();

// get repeated roleinfo instance
pFieldDynamic = pDescriptorDynamic-&gt;FindFieldByName("roleInfo");
pRoleInfoDynamic = pReflectionDynamic-&gt;AddMessage(pGameInfoDynamic, pFieldDynamic);

// set string filed name
pDescriptorDynamic = importer.pool()-&gt;FindMessageTypeByName("game.info.RoleInfo");
pEnumDescriptorDynamic = 
    importer.pool()-&gt;FindEnumTypeByName("game.enumeration.RoleType");
pFieldDynamic = pDescriptorDynamic-&gt;FindFieldByName("name");
pRoleInfoDynamic-&gt;GetReflection()-&gt;SetString(
    pRoleInfoDynamic, pFieldDynamic, "role_name_dynamic1"
);
// set enum filed type
pFieldDynamic = pDescriptorDynamic-&gt;FindFieldByName("type");
pRoleInfoDynamic-&gt;GetReflection()-&gt;SetEnum(
    pRoleInfoDynamic, 
    pFieldDynamic, 
    pEnumDescriptorDynamic-&gt;FindValueByName("MAGICIAN")
);

// get repeated iteminfo instance
pDescriptorDynamic = importer.pool()-&gt;FindMessageTypeByName("game.info.GameInfo");
pFieldDynamic = pDescriptorDynamic-&gt;FindFieldByName("itemInfo");
pItemInfoDynamic = pReflectionDynamic-&gt;AddMessage(pGameInfoDynamic, pFieldDynamic);

// set string filed name
pDescriptorDynamic = importer.pool()-&gt;FindMessageTypeByName("game.info.ItemInfo");
pFieldDynamic = pDescriptorDynamic-&gt;FindFieldByName("name");
pItemInfoDynamic-&gt;GetReflection()-&gt;SetString(
    pItemInfoDynamic, pFieldDynamic, "item_name_dynamic1"
);
// set int32 filed type
pFieldDynamic = pDescriptorDynamic-&gt;FindFieldByName("price");
pItemInfoDynamic-&gt;GetReflection()-&gt;SetInt32(
    pItemInfoDynamic, pFieldDynamic, 999999
);
</code></pre>

<p><br /></p>

<h4 id="compiler--run"><code class="highlighter-rouge">Compiler &amp;&amp; Run</code></h4>

<div class="highlighter-rouge"><pre class="highlight"><code>Comliper :
g++ -c -I./ GameInfo.pb.cc
g++ -c -I./ GameEnum.pb.cc
g++ -c -I./ CPP_TEST.cpp

Link :
g++ -L./ -lprotobuf GameEnum.pb.o GameInfo.pb.o CPP_TEST.o -o main

Compiler <span class="o">&amp;&amp;</span> Run :
g++ -I./ -L./ -lprotobuf GameInfo.pb.cc GameEnum.pb.cc CPP_TEST.cpp -o main

Run :
./main
</code></pre>
</div>

<p><br /></p>

<h3 id="serialize--parse--javascript">Serialize &amp;&amp; Parse / <code class="highlighter-rouge">javascript</code></h3>

<blockquote>
  <p>https://github.com/dcodeIO/protobuf.js</p>
</blockquote>

<h4 id="load-proto">Load Proto</h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">// cocos2d-js style</span>
<span class="nx">require</span><span class="p">(</span><span class="s2">"bytebuffer.js"</span><span class="p">);</span>
<span class="nx">require</span><span class="p">(</span><span class="s2">"protobuf.js"</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">ProtoBuf</span> <span class="o">=</span> <span class="nx">dcodeIO</span><span class="p">.</span><span class="nx">ProtoBuf</span><span class="p">;</span>

<span class="c1">// node.js style</span>
<span class="c1">// var ProtoBuf = require("./dist/protobuf");</span>

<span class="kd">var</span> <span class="nx">GameInfoBuilder</span> <span class="o">=</span> <span class="nx">ProtoBuf</span><span class="p">.</span><span class="nx">newBuilder</span><span class="p">();</span>

<span class="c1">// load .proto</span>
<span class="nx">ProtoBuf</span><span class="p">.</span><span class="nx">loadProtoFile</span><span class="p">(</span><span class="s2">"../PROTO/GameInfo.proto"</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">xappBuilder</span><span class="p">);</span>
<span class="nx">ProtoBuf</span><span class="p">.</span><span class="nx">loadProtoFile</span><span class="p">(</span><span class="s2">"../PROTO/GameEnum.proto"</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">xappBuilder</span><span class="p">);</span>
</code></pre>
</div>

<p><br /></p>

<h4 id="create-instance-1">Create Instance</h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">Game</span> <span class="o">=</span> <span class="nx">GameInfoBuilder</span><span class="p">.</span><span class="nx">build</span><span class="p">(</span><span class="s2">"game"</span><span class="p">);</span>

<span class="c1">// game</span>
<span class="kd">var</span> <span class="nx">gameInfoOut</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">info</span><span class="p">.</span><span class="nx">GameInfo</span><span class="p">();</span>

<span class="c1">// role</span>
<span class="kd">var</span> <span class="nx">roleInfo1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">info</span><span class="p">.</span><span class="nx">RoleInfo</span><span class="p">();</span>
<span class="nx">roleInfo1</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">"name1"</span><span class="p">;</span>
<span class="nx">roleInfo1</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">enumeration</span><span class="p">.</span><span class="nx">RoleType</span><span class="p">.</span><span class="nx">FIGHTER</span><span class="p">;</span>
<span class="nx">gameInfoOut</span><span class="p">.</span><span class="nx">roleInfo</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">roleInfo1</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">roleInfo2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">info</span><span class="p">.</span><span class="nx">RoleInfo</span><span class="p">();</span>
<span class="nx">roleInfo2</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">"name2"</span><span class="p">;</span>
<span class="nx">roleInfo2</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">enumeration</span><span class="p">.</span><span class="nx">RoleType</span><span class="p">.</span><span class="nx">BOWMAN</span><span class="p">;</span>
<span class="nx">gameInfoOut</span><span class="p">.</span><span class="nx">roleInfo</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">roleInfo2</span><span class="p">);</span>

<span class="c1">// item</span>
<span class="kd">var</span> <span class="nx">itemInfo1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">info</span><span class="p">.</span><span class="nx">ItemInfo</span><span class="p">();</span>
<span class="nx">itemInfo1</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">"item1"</span><span class="p">;</span>
<span class="nx">itemInfo1</span><span class="p">.</span><span class="nx">price</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="nx">gameInfoOut</span><span class="p">.</span><span class="nx">itemInfo</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">itemInfo1</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">itemInfo2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">info</span><span class="p">.</span><span class="nx">ItemInfo</span><span class="p">();</span>
<span class="nx">itemInfo2</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">"item2"</span><span class="p">;</span>
<span class="nx">itemInfo2</span><span class="p">.</span><span class="nx">price</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
<span class="nx">gameInfoOut</span><span class="p">.</span><span class="nx">itemInfo</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">itemInfo2</span><span class="p">);</span>
</code></pre>
</div>

<p><br /></p>

<h4 id="encode--decode">Encode / Decode</h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">// encode</span>
<span class="kd">var</span> <span class="nx">gameInfoData</span> <span class="o">=</span> <span class="nx">gameInfoOut</span><span class="p">.</span><span class="nx">encodeAB</span><span class="p">();</span>

<span class="c1">// decode</span>
<span class="kd">var</span> <span class="nx">gameInfoIn</span> <span class="o">=</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">info</span><span class="p">.</span><span class="nx">GameInfo</span><span class="p">.</span><span class="nx">decode</span><span class="p">(</span><span class="nx">gameInfoData</span><span class="p">,</span> <span class="s2">"utf8"</span><span class="p">);</span>

<span class="c1">// dump</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">gameInfoIn</span><span class="p">.</span><span class="nx">roleInfo</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">roleInfo</span> <span class="o">=</span> <span class="nx">gameInfoIn</span><span class="p">.</span><span class="nx">roleInfo</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="cm">/* ... */</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">gameInfoIn</span><span class="p">.</span><span class="nx">itemInfo</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">itemInfo</span> <span class="o">=</span> <span class="nx">gameInfoIn</span><span class="p">.</span><span class="nx">itemInfo</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="cm">/* ... */</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<p><br /></p>

<h4 id="load-from-bin">Load from <code class="highlighter-rouge">.bin</code></h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">gameInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">info</span><span class="p">.</span><span class="nx">GameInfo</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">ProtoBuf</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="s2">"../BIN/RoleInfo.bin"</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">gameInfo</span> <span class="o">=</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">info</span><span class="p">.</span><span class="nx">GameInfo</span><span class="p">.</span><span class="nx">decode</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="s2">"utf8"</span><span class="p">);</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">gameInfo</span><span class="p">.</span><span class="nx">roleInfo</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">roleInfo</span> <span class="o">=</span> <span class="nx">gameInfo</span><span class="p">.</span><span class="nx">roleInfo</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="cm">/* ... */</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">content</span> <span class="o">=</span> <span class="nx">ProtoBuf</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="s2">"../BIN/ItemInfo.bin"</span><span class="p">);</span>
<span class="nx">gameInfo</span> <span class="o">=</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">info</span><span class="p">.</span><span class="nx">GameInfo</span><span class="p">.</span><span class="nx">decode</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="s2">"utf8"</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">gameInfo</span><span class="p">.</span><span class="nx">itemInfo</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">itemInfo</span> <span class="o">=</span> <span class="nx">gameInfo</span><span class="p">.</span><span class="nx">itemInfo</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="cm">/* ... */</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<p><br /></p>

<h3 id="excel-xls-to-protobuf-bin--python">Excel <code class="highlighter-rouge">.xls</code> to ProtoBuf <code class="highlighter-rouge">.bin</code> / <code class="highlighter-rouge">Python</code></h3>

<h4 id="excel-format">Excel Format</h4>

<p>excel : <code class="highlighter-rouge">ItemInfo.xls</code></p>

<p>sheet name: <code class="highlighter-rouge">ItemInfo</code></p>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>name</th>
      <th>price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>item_name_1</td>
      <td>111</td>
    </tr>
    <tr>
      <td>2</td>
      <td>item_name_2</td>
      <td>222</td>
    </tr>
    <tr>
      <td>3</td>
      <td>item_name_3</td>
      <td>333</td>
    </tr>
  </tbody>
</table>

<p>excel : <code class="highlighter-rouge">RoleInfo.xls</code></p>

<p>sheet name: <code class="highlighter-rouge">RoleInfo</code></p>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>name</th>
      <th>type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>role_name_1</td>
      <td>1</td>
    </tr>
    <tr>
      <td>2</td>
      <td>role_name_2</td>
      <td>2</td>
    </tr>
    <tr>
      <td>3</td>
      <td>role_name_3</td>
      <td>3</td>
    </tr>
  </tbody>
</table>

<p><br /></p>

<h4 id="compiler-proto-1">Compiler <code class="highlighter-rouge">.proto</code></h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># dir</span>
<span class="n">PB_DIR</span> <span class="o">=</span> <span class="s">'./PROTO'</span>
<span class="n">PB_PY_DIR</span> <span class="o">=</span> <span class="s">'./PYTHON'</span>
<span class="n">XLS_DIR</span> <span class="o">=</span> <span class="s">'./XLS'</span>
<span class="n">BIN_DIR</span> <span class="o">=</span> <span class="s">'./BIN'</span>

<span class="s">'''
    eg:
        compile_protobuf(PB_DIR, PB_PY_DIR, 'a.proto', 'python')
        compile_protobuf(PB_DIR, PB_CPP_DIR, 'a.proto', 'cpp')
        compile_protobuf(PB_DIR, PB_JAVA_DIR, 'a.proto', 'java')
'''</span>
<span class="k">def</span> <span class="nf">compile_protobuf</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">proto_file</span><span class="p">,</span> <span class="n">language</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">language</span> <span class="o">==</span> <span class="s">'cpp'</span><span class="p">:</span>
        <span class="n">out_language</span> <span class="o">=</span> <span class="s">'cpp_out'</span>
    <span class="k">elif</span> <span class="n">language</span> <span class="o">==</span> <span class="s">'python'</span><span class="p">:</span>
        <span class="n">out_language</span> <span class="o">=</span> <span class="s">'python_out'</span>
    <span class="k">elif</span> <span class="n">language</span> <span class="o">==</span> <span class="s">'java'</span><span class="p">:</span>
        <span class="n">out_language</span> <span class="o">=</span> <span class="s">'java_out'</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">out_language</span> <span class="o">=</span> <span class="s">'python_out'</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">'protoc -I=</span><span class="si">%</span><span class="s">s --</span><span class="si">%</span><span class="s">s=</span><span class="si">%</span><span class="s">s </span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="p">(</span>
        <span class="n">src</span><span class="p">,</span> <span class="n">out_language</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">src</span> <span class="o">+</span> <span class="s">'/'</span> <span class="o">+</span> <span class="n">proto_file</span><span class="p">)</span>
    <span class="p">)</span>
</code></pre>
</div>

<p>The output :</p>

<pre><code class="language-C++">- PYTHON
    GameInfo_pb2.py
    GameEnum_pb2.py
</code></pre>

<p><br /></p>

<h4 id="dynamic-import">Dynamic import</h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">inspect</span>

<span class="k">def</span> <span class="nf">dynamic_import</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">PYTHON.GameInfo_pb2</span>
    <span class="n">import_py</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="s">'PYTHON.GameInfo_pb2'</span><span class="p">)</span>
    <span class="n">pb_attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">import_py</span><span class="p">,</span> <span class="s">'GameInfo_pb2'</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">import_py</span>

    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">PYTHON</span><span class="o">.</span><span class="n">GameInfo_pb2</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="n">import_pb_class</span><span class="p">(</span><span class="n">pb_attr</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            
<span class="k">def</span> <span class="nf">import_pb_class</span><span class="p">(</span><span class="n">pb_attr</span><span class="p">,</span> <span class="n">class_name</span><span class="p">):</span>
    <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">pb_attr</span><span class="p">,</span> <span class="n">class_name</span><span class="p">)</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">__name__</span><span class="p">],</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>

    <span class="n">descriptor</span> <span class="o">=</span> <span class="n">make_descriptor_name</span><span class="p">(</span><span class="n">class_name</span><span class="p">)</span>
    <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">pb_attr</span><span class="p">,</span> <span class="n">descriptor</span><span class="p">)</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">__name__</span><span class="p">],</span> <span class="n">descriptor</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">make_descriptor_name</span><span class="p">(</span><span class="n">class_name</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">'_'</span> <span class="o">+</span> <span class="n">class_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</code></pre>
</div>

<p><br /></p>

<h4 id="parse-xls">Parse <code class="highlighter-rouge">.xls</code></h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">parse_xls_files</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">worksheet_name</span><span class="p">,</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">get_xls_files</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">message_object</span> <span class="o">=</span> <span class="n">class_from_string</span><span class="p">(</span><span class="n">worksheet_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">message_object</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">list_fields</span><span class="p">(</span><span class="n">make_descriptor_name</span><span class="p">(</span><span class="n">worksheet_name</span><span class="p">))</span>
        <span class="n">parse_table</span><span class="p">(</span><span class="n">worksheet_name</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">class_from_string</span><span class="p">(</span><span class="n">class_name</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">__name__</span><span class="p">],</span> <span class="n">class_name</span><span class="p">)()</span>
        <span class="k">return</span> <span class="n">instance</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
</code></pre>
</div>
<p><br /></p>

<h4 id="list-fields">List fields</h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">list_fields</span><span class="p">(</span><span class="n">class_name</span><span class="p">):</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">__name__</span><span class="p">],</span> <span class="n">class_name</span><span class="p">)</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="nb">type</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">fields</span>
</code></pre>
</div>

<p><br /></p>

<h4 id="parse-table">Parse table</h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">parse_table</span><span class="p">(</span><span class="n">worksheet_name</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">fields</span><span class="p">):</span>
    <span class="c">## all data will be put into a GameInfo instance</span>
    <span class="n">gameInfo</span> <span class="o">=</span> <span class="n">class_from_string</span><span class="p">(</span><span class="s">'GameInfo'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ri</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">)):</span>
        <span class="c"># ...</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">ri</span><span class="p">]</span>
        <span class="n">message</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">value_index</span> <span class="o">=</span> <span class="n">get_value_index</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c"># ...</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">convert_pb_type</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">value_index</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">field</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="c"># ...</span>
            <span class="n">message</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
                <span class="n">gameInfo</span><span class="p">,</span> <span class="n">worksheet_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="n">worksheet_name</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">()</span> 
            <span class="nb">setattr</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">value</span><span class="p">)</span>
    <span class="c"># write to .bin</span>
    <span class="c"># ...</span>
    <span class="n">serializedObject</span> <span class="o">=</span> <span class="n">gameInfo</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">()</span>
    <span class="n">pb_bin_file</span> <span class="o">=</span> <span class="s">"./bin/</span><span class="si">%</span><span class="s">s.bin"</span> <span class="o">%</span> <span class="n">worksheet_name</span>
    <span class="n">pb_bin</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">pb_bin_file</span><span class="p">,</span> <span class="s">"wb"</span><span class="p">)</span>
    <span class="n">pb_bin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">serializedObject</span><span class="p">)</span>
    <span class="n">pb_bin</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
<span class="k">def</span> <span class="nf">convert_pb_type</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="ow">in</span> <span class="p">[</span><span class="n">FieldDescriptor</span><span class="o">.</span><span class="n">TYPE_INT64</span><span class="p">,</span> 
                <span class="n">FieldDescriptor</span><span class="o">.</span><span class="n">TYPE_UINT64</span><span class="p">,</span> 
                <span class="n">FieldDescriptor</span><span class="o">.</span><span class="n">TYPE_INT32</span><span class="p">,</span> 
                <span class="n">FieldDescriptor</span><span class="o">.</span><span class="n">TYPE_ENUM</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="ow">in</span> <span class="p">[</span><span class="n">FieldDescriptor</span><span class="o">.</span><span class="n">TYPE_DOUBLE</span><span class="p">,</span> 
                  <span class="n">FieldDescriptor</span><span class="o">.</span><span class="n">TYPE_FLOAT</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="ow">in</span> <span class="p">[</span><span class="n">FieldDescriptor</span><span class="o">.</span><span class="n">TYPE_STRING</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
</code></pre>
</div>

<p>Generated <code class="highlighter-rouge">.bin</code></p>

<pre><code class="language-C++">// ItemInfo.bin
GameInfo
    repeated RoleInfo roleInfo =&gt;
    {
        RoleInfo1,
        RoleInfo2,
        RoleInfo3,
        ...
    }
    repeated ItemInfo itemInfo =&gt; None

// RoleInfo.bin
GameInfo
    repeated RoleInfo roleInfo =&gt; None
    repeated ItemInfo itemInfo =&gt; 
    {
        ItemInfo1,
        ItemInfo2,
        ItemInfo3,
        ...
    }
</code></pre>

<p><br /></p>

<h4 id="bin-security"><code class="highlighter-rouge">.bin</code> security</h4>

<p><code class="highlighter-rouge">.bin</code> can be decoded using <code class="highlighter-rouge">protoc</code> command.</p>

<h5 id="decode-with-proto">decode with <code class="highlighter-rouge">proto</code></h5>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="n">message_name</span><span class="p">,</span> <span class="n">proto_name</span><span class="p">,</span> <span class="n">bin_name</span><span class="p">):</span>
    <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
        <span class="p">[</span><span class="s">'/usr/local/bin/protoc'</span><span class="p">,</span> <span class="s">'--decode'</span><span class="p">,</span> <span class="n">message_name</span><span class="p">,</span> <span class="n">proto_name</span><span class="p">],</span>
        <span class="n">stdin</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
        <span class="n">stdout</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
        <span class="n">stderr</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span>
    <span class="p">)</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">bin_name</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">output</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">communicate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">'error: '</span> <span class="o">+</span> <span class="n">error</span> 
    <span class="k">except</span> <span class="nb">OSError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">poll</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">process</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">output</span>

<span class="k">print</span> <span class="s">'------ result ------</span><span class="se">\n</span><span class="s">'</span>
<span class="k">print</span> <span class="s">'message_name: '</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">print</span> <span class="s">'proto_name: '</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="k">print</span> <span class="s">'bin_name: '</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="k">print</span>
<span class="k">print</span> <span class="n">decode</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="k">print</span> <span class="s">'------ ------ ------</span><span class="se">\n</span><span class="s">'</span>
</code></pre>
</div>

<p>Test with <code class="highlighter-rouge">ItemInfo.bin</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">root$ </span>python decode.py game.info.GameInfo GameInfo.proto ItemInfo.bin

------ result ------
message_name: game.info.GameInfo
proto_name: GameInfo.proto
bin_name: ItemInfo.bin

itemInfo <span class="o">{</span>
  name: <span class="s2">"item1"</span>
  price: 100
<span class="o">}</span>
itemInfo <span class="o">{</span>
  name: <span class="s2">"item2"</span>
  price: 101
<span class="o">}</span>
......
------ ------ ------
</code></pre>
</div>

<h5 id="decode-with-proto-1">decode with <code class="highlighter-rouge">proto</code></h5>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="k">def</span> <span class="nf">decode_raw</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
        <span class="p">[</span><span class="s">'/usr/local/bin/protoc'</span><span class="p">,</span> <span class="s">'--decode_raw'</span><span class="p">],</span>
        <span class="n">stdin</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
        <span class="n">stdout</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
        <span class="n">stderr</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span>
    <span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">output</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">communicate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">OSError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">poll</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">process</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">output</span>

<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">"rb"</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="k">print</span> <span class="s">'------ data ------</span><span class="se">\n</span><span class="s">'</span>
<span class="k">print</span> <span class="n">data</span>
<span class="k">print</span> <span class="s">'------ ------ ------</span><span class="se">\n</span><span class="s">'</span>

<span class="k">print</span> <span class="s">'------ result ------</span><span class="se">\n</span><span class="s">'</span>
<span class="k">print</span> <span class="n">decode_raw</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="k">print</span> <span class="s">'------ ------ ------</span><span class="se">\n</span><span class="s">'</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre>
</div>

<p>Test with <code class="highlighter-rouge">ItemInfo.bin</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">root$ </span>python decode_raw.py ItemInfo.bin 

------ data ------

    
item1d  
item2e  
item3f  
item4g  
item5h  
item6i  
item7j  
item8k  
item9l

item10m
------ ------ ------

------ result ------

2 <span class="o">{</span>
  1: <span class="s2">"item1"</span>
  2: 100
<span class="o">}</span>
2 <span class="o">{</span>
  1: <span class="s2">"item2"</span>
  2: 101
<span class="o">}</span>
2 <span class="o">{</span>
  1: <span class="s2">"item3"</span>
  2: 102
<span class="o">}</span>
......
------ ------ ------
</code></pre>
</div>

<h5 id="decode-raw-data--network-data-transfer-">decode raw data ( network data transfer )</h5>

<blockquote>
  <p><a href="https://github.com/erikdw/protoc-decode-lenprefix">protoc-decode-lenprefix on Github</a></p>
</blockquote>

<p><br /></p>

<h3 id="jsbinding">JSBinding</h3>

<h4 id="send-from-c">Send from <code class="highlighter-rouge">C++</code></h4>

<pre><code class="language-C++">JSObject* pGlobalObject = ScriptingCore::getInstance()-&gt;getGlobalObject();
JSContext* pGlobalContext = ScriptingCore::getInstance()-&gt;getGlobalContext();

// Create a GameInfo object first
game::info::GameInfo gameInfo;

// add RoleInfo object to repeated field
game::info::RoleInfo *pRoleInfo1 = gameInfo.add_roleinfo();
pRoleInfo1-&gt;set_name("cpp_name1");
pRoleInfo1-&gt;set_type(game::enumeration::FIGHTER);

// add another RoleInfo object to repeated field
game::info::RoleInfo *pRoleInfo2 = gameInfo.add_roleinfo();
pRoleInfo2-&gt;set_name("cpp_name2");
pRoleInfo2-&gt;set_type(game::enumeration::BOWMAN);

// add ItemInfo object to repeated field
game::info::ItemInfo *pItemInfo1 = gameInfo.add_iteminfo();
pItemInfo1-&gt;set_name("cpp_item1");
pItemInfo1-&gt;set_price(100);

// add another ItemInfo object to repeated field
game::info::ItemInfo *pItemInfo2 = gameInfo.add_iteminfo();
pItemInfo2-&gt;set_name("cpp_item2");
pItemInfo2-&gt;set_price(200);

// SerializeToString
std::string gameInfoString;
gameInfo.SerializeToString(&amp;gameInfoString);

// convert gameInfoString to jsval to send to javascript
JSAutoCompartment ac(pGlobalContext, pGlobalObject);
int length = gameInfoString.length();
JSObject* pMessageJSObject = JS_NewArrayBuffer(pGlobalContext, length);
uint8_t* pMessageData = JS_GetArrayBufferData(pMessageJSObject);
memcpy(
    (void*)pMessageData, 
    (const void*)gameInfoString.c_str(), 
    gameInfoString.length()
);

JS::RootedValue ret(pGlobalContext);
jsval arg = OBJECT_TO_JSVAL(pMessageJSObject);
ScriptingCore::getInstance()-&gt;executeFunctionWithOwner(
    OBJECT_TO_JSVAL(pGlobalObject), "test_protobuf", 1, &amp;arg, &amp;ret
);
</code></pre>

<p><br /></p>

<h4 id="receive-from-c">Receive from <code class="highlighter-rouge">C++</code></h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">// cc_js_bridge.js</span>
<span class="nx">test_protobuf</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">ProtoBuf</span> <span class="o">=</span> <span class="nx">dcodeIO</span><span class="p">.</span><span class="nx">ProtoBuf</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">GameInfoBuilder</span> <span class="o">=</span> <span class="nx">ProtoBuf</span><span class="p">.</span><span class="nx">newBuilder</span><span class="p">();</span>
    
    <span class="c1">// load .proto</span>
    <span class="nx">ProtoBuf</span><span class="p">.</span><span class="nx">protoFromContents</span><span class="p">(</span>
        <span class="s2">"res/GameEnum.proto"</span><span class="p">,</span> 
        <span class="nx">GameInfoBuilder</span><span class="p">,</span> 
        <span class="nx">jsb</span><span class="p">.</span><span class="nx">fileUtils</span><span class="p">.</span><span class="nx">getStringFromFile</span><span class="p">(</span><span class="s2">"res/GameEnum.proto"</span><span class="p">)</span>
    <span class="p">);</span>
    <span class="nx">ProtoBuf</span><span class="p">.</span><span class="nx">protoFromContents</span><span class="p">(</span>
        <span class="s2">"res/GameInfo.proto"</span><span class="p">,</span> 
        <span class="nx">GameInfoBuilder</span><span class="p">,</span> 
        <span class="nx">jsb</span><span class="p">.</span><span class="nx">fileUtils</span><span class="p">.</span><span class="nx">getStringFromFile</span><span class="p">(</span><span class="s2">"res/GameInfo.proto"</span><span class="p">)</span>
    <span class="p">);</span>
    
    <span class="c1">// decode protobuf message from C++ </span>
    <span class="kd">var</span> <span class="nx">Game</span> <span class="o">=</span> <span class="nx">GameInfoBuilder</span><span class="p">.</span><span class="nx">build</span><span class="p">(</span><span class="s2">"game"</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">gameInfo</span> <span class="o">=</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">info</span><span class="p">.</span><span class="nx">GameInfo</span><span class="p">.</span><span class="nx">decode</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="s2">"utf8"</span><span class="p">);</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Add a <code class="highlighter-rouge">protoFromContents</code> <code class="highlighter-rouge">function</code> to <code class="highlighter-rouge">protobuf.js</code> :</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nx">ProtoBuf</span><span class="p">.</span><span class="nx">protoFromContents</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">builder</span><span class="p">,</span> <span class="nx">contents</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">contents</span> <span class="o">===</span> <span class="kc">null</span> <span class="p">?</span> <span class="kc">null</span> <span class="p">:</span> <span class="nx">ProtoBuf</span><span class="p">.</span><span class="nx">loadProto</span><span class="p">(</span>
        <span class="nx">contents</span><span class="p">,</span> <span class="nx">builder</span><span class="p">,</span> <span class="nx">filename</span>
    <span class="p">);</span>
<span class="p">};</span>
</code></pre>
</div>

<p><br /></p>

<h4 id="send-from-javascript">Send from <code class="highlighter-rouge">javascript</code></h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">gameInfoOut</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">info</span><span class="p">.</span><span class="nx">GameInfo</span><span class="p">();</span>
    
<span class="kd">var</span> <span class="nx">roleInfo1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">info</span><span class="p">.</span><span class="nx">RoleInfo</span><span class="p">();</span>
<span class="nx">roleInfo1</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">"js_name1"</span><span class="p">;</span>
<span class="nx">roleInfo1</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">enumeration</span><span class="p">.</span><span class="nx">RoleType</span><span class="p">.</span><span class="nx">FIGHTER</span><span class="p">;</span>
<span class="nx">gameInfoOut</span><span class="p">.</span><span class="nx">roleInfo</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">roleInfo1</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">roleInfo2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">info</span><span class="p">.</span><span class="nx">RoleInfo</span><span class="p">();</span>
<span class="nx">roleInfo2</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">"js_name2"</span><span class="p">;</span>
<span class="nx">roleInfo2</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">enumeration</span><span class="p">.</span><span class="nx">RoleType</span><span class="p">.</span><span class="nx">BOWMAN</span><span class="p">;</span>
<span class="nx">gameInfoOut</span><span class="p">.</span><span class="nx">roleInfo</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">roleInfo2</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">itemInfo1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">info</span><span class="p">.</span><span class="nx">ItemInfo</span><span class="p">();</span>
<span class="nx">itemInfo1</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">"js_item1"</span><span class="p">;</span>
<span class="nx">itemInfo1</span><span class="p">.</span><span class="nx">price</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="nx">gameInfoOut</span><span class="p">.</span><span class="nx">itemInfo</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">itemInfo1</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">itemInfo2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">info</span><span class="p">.</span><span class="nx">ItemInfo</span><span class="p">();</span>
<span class="nx">itemInfo2</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">"js_item2"</span><span class="p">;</span>
<span class="nx">itemInfo2</span><span class="p">.</span><span class="nx">price</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
<span class="nx">gameInfoOut</span><span class="p">.</span><span class="nx">itemInfo</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">itemInfo2</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">gameInfoOut</span><span class="p">.</span><span class="nx">encodeAB</span><span class="p">();</span>
</code></pre>
</div>

<p><br /></p>

<h4 id="receive-from-javascript">Receive from <code class="highlighter-rouge">javascript</code></h4>

<pre><code class="language-C++">// ...
JS::RootedValue ret(pGlobalContext);
jsval arg = OBJECT_TO_JSVAL(pMessageJSObject);
ScriptingCore::getInstance()-&gt;executeFunctionWithOwner(
    OBJECT_TO_JSVAL(pGlobalObject), "test_protobuf", 1, &amp;arg, &amp;ret
);
// convert JS::RootedValue ret to protobuf message
game::info::GameInfo* pGameInfo = new game::info::GameInfo;
JSObject* pRetJSObject = ret.toObjectOrNull();
if(pRetJSObject &amp;&amp; JS_IsArrayBufferObject(pRetJSObject)) {
    uint8_t* pDataBuffer = nullptr;
    int dataBufferCount = 0;
    pDataBuffer = JS_GetArrayBufferData(pRetJSObject);
    dataBufferCount = JS_GetArrayBufferByteLength(pRetJSObject);
    pGameInfo-&gt;ParseFromArray(pDataBuffer, dataBufferCount);
    // ...
}
</code></pre>

<p><br /></p>

<h2 id="others">Others</h2>

<h3 id="sublime-text3-proto-plugin">Sublime Text3 <code class="highlighter-rouge">.proto</code> plugin</h3>

<p><a href="https://packagecontrol.io/packages/Protocol%20Buffer%20Syntax">Protocol Buffer Syntax</a></p>

<blockquote>
  <p>https://github.com/google/protobuf</p>

  <p>https://github.com/google/protobuf/releases</p>
</blockquote>
</span>

        
        <div class="tags">
          <small>
          <i class="fa fa-tags"></i>
            tag1, tag2
          </small>
        </div>
        

        
        <div class="share">
          <!-- Go to www.addthis.com/dashboard to customize your tools -->
          <div class="addthis_sharing_toolbox"></div>
        </div>
        

      </div>

      <div class="content-panel feedback">
        
          I <i class="fa fa-heart"></i> feedback.<br />
          Let me know what you think of this article on twitter <a href="http://www.twitter.com/supersuraccoon">@supersuraccoon</a> or leave a comment below!
        

        

        

      </div>

      
      <div class="content-panel comments">
        <div id="disqus_thread">
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
      </div>
      

<!--        -->

    </div>

  </div>

</div>


<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
function disqus_config() { this.experiment.enable_scroll_container = true; }
var disqus_shortname = "supersuraccoon"; // required: replace example with your forum shortname
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>


      </div>
    </div>
    <div class="footer clearfix">
  <div class="col-md-6">
      
          Made with <i class="fa fa-heart"></i> by SuperSuRaccoon
      

      

      
  </div>
  <div class="col-md-6">
      
        <i class="fa fa-send"></i> : <a href="mailto:supersuraccoon@gmail.com">supersuraccoon@gmail.com</a>
      

      

      
  </div>
</div>

<script src="/js/jquery-1.11.0.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/jquery.mmenu.min.all.js"></script>
<script src="/js/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
   $(document).ready(function() {
      $("#my-menu").css("visibility", true);
      $("#my-menu").mmenu().on( "closed.mm", function() {
            $(".menu-button").show();
         });
      $(".menu-button").click(function() {
        $(".menu-button").hide();
        $("#my-menu").trigger("open.mm");
      });
   });
</script>


<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-75311916-1']);
          _gaq.push(['_trackPageview']);
  (function () {
      var ga = document.createElement('script');
      ga.type = 'text/javascript';
      ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';

      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(ga, s);
  })();
</script>



    </body>
</html>
